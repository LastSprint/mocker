<p align="center">
  <img src="logo.png">
</p>


![Actions](https://github.com/LastSprint/mocker/workflows/Build/badge.svg)
[![codecov](https://codecov.io/gh/LastSprint/mocker/branch/master/graph/badge.svg)](https://codecov.io/gh/LastSprint/mocker)
[![Go Report Card](https://goreportcard.com/badge/github.com/LastSprint/mocker)](https://goreportcard.com/report/github.com/LastSprint/mocker)

This is a web server which is used to imitate a real backend.

Само по себе приложения представляет из себя обычный ротуер HTTP-запросов. 
Приложение принимает запрос из сети, парсит URL и HTTP-method. Затем проходится по известным мокам. Берет мок с подходящим URL и HTTP-method'ом, читает код ответа и тело ответа, а затем возвращает ответ клиенту.

В случае, если существует несколько моков с одинаковыми URL и Method, то приложение объединяет их в группу а затем закольцовано итерирует по ним.

После того, как были внесены изменения в моки необходимо, чтобы сервер обновил у себя данные.

Ознакомиться со всеми функциональными возможностями можно [тут](docks/features.md)

Сделать это можно так: `curl 127.0.0.1:port/update_models`

## Моки

Моковые файлы представляют из себя `Json` формата:
```
 {
    "isDisabled": bool,
    "isOnly": bool,
    "isExcludedFromIteration": bool,
    "url": string,
    "method": string,
    "statusCode": int,
    "responseDelay": int,
    "response": object,
    "request": object
    "responseHeaders": object
    "requestHeaders": {
        "key": "value",
         .....
     }
 }
```

Буквально здесь записано следующее:
На запрос с `URL = url` и `Method = method` вернуть ответ `response` с кодом `statusCode`

### URL

Может быть следующих видов:

1. `path/to/endpoint` - обычный url адрес. Во время получения запроса сервис будет сравнивать строки посимвольно.
2. `path/to/endpoint/{number}` - url с path-паттерном. Мок с таким URL будет реагировать на любой запрос который удовлетворяет этому шаблону.
3. `path/to/endpoint/data?param={value}` - url c parameter-паттерном. Мок с таким url сработает на запрос, содержащий заданные параметры. При этом, если одного из параметров не будет в запросе, то он не сматчится с шаблоном.

### Method

Пишите названия HTTP методов в UpperCase. 
**НЕ** `get` **А**  `GET` 

### Status Code

Любое целое число. Желательно из известных [HTTP-кодов](https://ru.wikipedia.org/wiki/Список_кодов_состояния_HTTP)

### Response

Это поле содержит `Json`, который вернется в ответ на запрос. 

### Request

Это поле содержит данные для поиска конкретного мока. 

Подробнее можно прочесть [здесь](/docks/features.md/#cравнение-по-параметрам)

### RequestHeaders

Это поле содержит данные для поиска конкретного мока

Подробнее [тут](/docks/features.md/#сравнение-по-заголовкам)

### ResponseHeaders

Содержит список пар ключ-значение где ключ - имя хедера, а value - значение. 

Например, если мы хотим чтоб мокер вернул заголово `X-Example-Header` со значением `example_value` то пишем: 

```Json
"responseHeaders": {
  "X-Example-Header": "example_value"
}
```

### IsDisabled

Флаг, который может перевести мок в состояние "выключен". В случае, если значение `isDisabled == true`, то мок не будет участвовать в выдаче. 

В случае, если значение `false` или `nil`, то поведение стандартное.

### IsOnly

Флаг, который отключает все моки, кроме одного конкретного. Если для какого-то мока `IsOnly == true`, то в выдаче будет учавствовать ТОЛЬКО этот мок. Все остальные будут считаться "выключеными". 

В случае, если для мока одновременно `IsOnly == true` и `IsDisabled == true`, то значение `IsDisabled` игнорируется. 

В случае, если `IsOnly == true` одновременно для нескольких моков, то ВСЕГДА будет отдаваться ПЕРВЫЙ по порядку мок. Никакого итерирования (пока во всяком случае) нет. 

При этом, счетчик итератора не сбрасывается. То есть если итератор указывал на n-й файл, то после включения и отключения `IsOnly` итератор все так же будет указывать на n-й мок.

### ResponseDelay

Это поле нужно для того, чтобы специально замедлить ответ сервера с конкретным моком. То есть все моки, у которых значение этого поля != 0 будут замедляться на указанное время. Время измеряется в секундах. 

### IsExcludedFromIteration

Это поле используется для того, чтобы исключить мок из итеративных ответов. Пример использования: когда у вас есть мок с заданным телом запроса и вы хоитте чтоб он возвращался только в том случае, когда в запросе пришло именно это тело. 
 
По-умолчанию: `false`
 
## Конфигурация

Приложение имеет конфиг в `Json` следующего формата:
```
{
    "mocksRootDir": string,
    "port": int,
    "logPath": string
}
```

### Mocks Root Dir

Это путь до папки, которая является корневой для файлов с моками. 

### Port

TCP-порт, который будет слушать приложение

### Log Path

Путь до файла с логами. Туда приложение будет писать логи работы.

## Docker

Чтобы запустить сервис с web-ui через докер нужно выполнить:

```
cd docker
docker-compose -p mocker --no-cache up
```
