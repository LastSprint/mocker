# Инстересные возможности Mocker

Здесь будут описаны все интересные возможности Mocker, которые позволяют использовать этот сервис более эффективно. 

## Кэширующий прокси

Mocker поддерживает функцию проксирования. 
Клиент делает запрос в Mocker.
Mocker перенаправляет запрос на реальный сервер
Если вернулся ответ с 200-м кодом, то Mocker сохраняет полученный ответ как моковый файл. 
Mocker возращает клиенту ответ от сервера

Эта функция может быть очень полезна когда вам нужно поддерживать актуальную базу моков.
Для того, чтобы использовать эту функцию необходимо установить 3 кастомных хедера в тот запрос, для которого нужно использовать эту функциональность.

```
X-Mocker-Redirect-Is-On: "true",
X-Mocker-Redirect-Host: "hostaname.ex:1234", // адрес хоста (опционально с портом) на который нужно перенаправить запрос
X-Mocker-Redirect-Scheme: "http"
```

А так же когда Mocker получил нужный ответ, он самостоятельно формирует путь для сохранения файла, причем путь берется из URL запроса!

Например, пусть клиент отправил запрос `GET host.ex/path/to/endpoint`. 
После того как Mocker получит ответ от реального сервера, то он в `config.mocksRootDir` создаст папку `host.ex`.
Внутри нее `path`, внутри нее `to`, внутри нее `endpoint`. И уже в последнюю папку он положит файл, который будет иметь название по шаблону `$http_method$_$reponse_body_hash$`. 

Таким образом это автоматическое сохранение моковых файлов наоборот упорядочивает уже имеющиеся файлы, и к тому же не захламляет одинаковыми моками, потому что если ответ тот же самый, то хеши совпадут и файл просто перезапишется.

## Явное указание пути к мокам

Иногда хочется, чтобы Mocker возвращал только те моки, которые мы хотим. А не все остальные, которые есть в проекте. 

Особенно актуально это дле тестеровщиков. Им было бы удобно иметь какой-то заготовленный, выделенный набор моков, каждый из которых соответствует определенным тест-кейсам. И тогда, во время тестирования, тестер просто выбирает нужные ему папку и спокойно работает, потому что больше нет шума из сторонних моков. 

Сейчас такое возможно. Для того, чтобы включить эту функцию нужно использовать специальный хедер 

```
X-Mocker-Specific-Path: path
```

К примеру, пусть у Mocker-а в корне вот такая структура папок

```
root/
    block_card_test_case/
        mocks....
    main_test_case/
        blocked_test_case/
        mocks...
```
Если необходимо прогнать тест-кейс о заблокированных картах, тогда `X-Mocker-Specific-Path: block_card_test_case`

Если необходимо прогнать тест-кейс связанный с блокировкой главного экрана, тогда `X-Mocker-Specific-Path: main_test_case/blocked_test_case`
